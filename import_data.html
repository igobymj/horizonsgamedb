<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Data Importer</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: monospace; padding: 20px; background: #222; color: #0f0; }
        #log { margin-top: 20px; white-space: pre-wrap; }
        button { padding: 10px 20px; font-size: 1.2em; cursor: pointer; font-family: monospace; }
        .error { color: #ff5555; }
        .success { color: #55ff55; }
    </style>
</head>
<body>

    <h1>Database Importer Tool</h1>
    <p>Make sure you have created the 'games' table in Supabase first!</p>
    <button onclick="runImport()">START IMPORT SEQUENCE</button>
    <div id="log">Waiting...</div>

    <script>
        // ==========================================
        // 1. PASTE YOUR SUPABASE KEYS HERE
        // ==========================================
        const PROJECT_URL = 'https://xylhehjbonypyjiyhkkt.supabase.co/';
        const ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh5bGhlaGpib255cHlqaXloa2t0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNjkxNjEsImV4cCI6MjA3ODY0NTE2MX0.rWKrKSOCJBLVMPgSt5TAjjIYdFr6tO2Y7V0lQPDz9As';

        const supabaseClient = supabase.createClient(PROJECT_URL, ANON_KEY);

        // ==========================================
        // 2. YOUR ORIGINAL DATA (I pasted it for you)
        // ==========================================
        const gamesData = [
            {
                institution: "UCLA",
                year: 2024,
                gameTitle: "Echoes of the Void",
                gameCreators: ["Alex Chen", "Maya Singh"],
                gameGenre: "Puzzle",
                keywords: ["2D", "Sound-based", "Narrative", "Atmospheric"],
                gameImages: ["echoes.jpg"],
                linkToVideo: "https://youtube.com/link-to-video-1",
                linkToDownloadableGame: "#",
                linkToSourceRepository: "https://github.com/project-1",
                artistsStatement: "Echoes of the Void explores themes of isolation...",
            },
            {
                institution: "NYU",
                year: 2023,
                gameTitle: "Canyon Run",
                gameCreators: ["Jordan Lee"],
                gameGenre: "Platformer",
                keywords: ["3D", "Procedural", "Speedrun", "Low-poly"],
                gameImages: ["https://upload.wikimedia.org/wikipedia/commons/thumb/4/4c/Pong.png/640px-Pong.png"],
                linkToVideo: "https://youtube.com/link-to-video-2",
                linkToDownloadableGame: "#",
                linkToSourceRepository: "https://github.com/project-2",
                artistsStatement: "This project was an exercise in procedural generation...",
            },
            {
                institution: "UCLA",
                year: 2024,
                gameTitle: "The Last Scroll",
                gameCreators: ["Sarah K. and Team Alpha"],
                gameGenre: "RPG",
                keywords: ["Fantasy", "Turn-based", "Pixel Art", "Story-rich"],
                gameImages: [
                    "https://upload.wikimedia.org/wikipedia/commons/thumb/2/27/Pac-Man_screenshot.png/640px-Pac-Man_screenshot.png",
                    "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Donkey_Kong_screenshot.png/640px-Donkey_Kong_screenshot.png",
                    "https://upload.wikimedia.org/wikipedia/commons/thumb/b/b3/Pitfall%21_Gameplay.jpg/640px-Pitfall%21_Gameplay.jpg"
                ],
                linkToVideo: "https://youtube.com/link-to-video-3",
                linkToDownloadableGame: "#",
                linkToSourceRepository: "https://github.com/project-3",
                artistsStatement: "Inspired by classic JRPGs...",
            },
            {
                institution: "NYU",
                year: 2023,
                gameTitle: "Starship Odyssey",
                gameCreators: ["Team Nebula"],
                gameGenre: "Action",
                keywords: ["Space", "Shooter", "Sci-Fi", "Arcade"],
                gameImages: [],
                linkToVideo: "https://youtube.com/link-to-video-4",
                linkToDownloadableGame: "#",
                linkToSourceRepository: "https://github.com/project-4",
                artistsStatement: "A fast-paced arcade shooter...",
            },
            {
                institution: "UCLA",
                year: 2024,
                gameTitle: "Mystic Maze",
                gameCreators: ["Liam and Chloe"],
                gameGenre: "Adventure",
                keywords: ["Retro", "Text-based", "Exploration", "Fantasy"],
                gameImages: ["https://upload.wikimedia.org/wikipedia/commons/thumb/2/22/Zork_I_-_PDP-11.png/640px-Zork_I_-_PDP-11.png"],
                linkToVideo: "https://youtube.com/link-to-video-5",
                linkToDownloadableGame: "#",
                linkToSourceRepository: "https://github.com/project-5",
                artistsStatement: "Mystic Maze is a homage to early text adventures...",
            }
        ];

        // ==========================================
        // 3. THE IMPORT LOGIC
        // ==========================================
        async function runImport() {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML = "Starting import...\n";

            for (let i = 0; i < gamesData.length; i++) {
                const game = gamesData[i];
                
                // MAPPING: Old JS Name -> New Database Column Name
                const payload = {
                    gameTitle: game.gameTitle,
                    institution: game.institution,
                    year: game.year,
                    gameGenre: game.gameGenre,
                    creators: game.gameCreators,        // Renamed
                    keywords: game.keywords,
                    description: game.artistsStatement, // Renamed
                    videoLink: game.linkToVideo,        // Renamed
                    repoLink: game.linkToSourceRepository, // Renamed
                    imageURLs: game.gameImages          // Renamed
                    // Note: We didn't map 'linkToDownloadableGame' 
                    // because we didn't create a column for it yet.
                    // If you added that column, add: downloadLink: game.linkToDownloadableGame
                };

                logDiv.innerHTML += `> Uploading "${game.gameTitle}"... `;

                const { error } = await supabaseClient
                    .from('games')  // Make sure this matches your actual table name
                    .insert(payload);

                if (error) {
                    console.error(error);
                    logDiv.innerHTML += `<span class="error">FAILED: ${error.message}</span>\n`;
                    // Check specifically for RLS error
                    if(error.message.includes("violates row-level security policy")) {
                         logDiv.innerHTML += `  (HINT: Did you create the "Enable Insert for Everyone" policy in Supabase?)\n`;
                    }
                } else {
                    logDiv.innerHTML += `<span class="success">DONE</span>\n`;
                }
            }
            
            logDiv.innerHTML += "\n--- IMPORT COMPLETE ---";
        }
    </script>
</body>
</html>